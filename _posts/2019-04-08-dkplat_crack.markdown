---
layout: post
title: 「多开分身」机型模拟功能屏蔽的破解
date: '2019-04-08 14:37:14'
tags:
- android
- charles
- 机型模拟
---

个人需要，我一直有机型模拟的需求，之前是在用安卓上的「多开分身」提供的机型模拟插件来实现机型模拟，最近换手机，要把模拟的app也迁移过来，然后意外的发现「多开分身」的新版本中，机型模拟功能已经被严重阉割了，不管是否付费VIP，机型模拟功能都只能随意指定一个机型，而无法做到自定详细参数，对我而言就无用了。我尝试过安装旧版，第一次打开的时候还能看到机型伪装，过了一会机型伪装功能就也没了，推测是官方通过api关掉了这个功能（也许是出于求生欲考量？）我也尝试了在断网模式下进行机型模拟，软件报错：初始化插件服务器失败，看来在开启机型伪装的时候，软件还会请求服务器验证功能是否可以启用，那我们就需要进一步研究了

既然是通过api关掉的这两个功能，那么我们就还有办法抢救一下，只需要抓包找到api请求，然后破解一下，应该就可以正常使用了。

抓包后，意外的发现，可能由于程序够老，还使用的http方式请求的api，连中间人攻击都不需要，就能直接截获传输内容

经过抓包分析，我发现```chaos.91ishare.cn/ServerV60?fn=apkplug```这个地址的返回非常可疑，其返回为
``` json
{"err":"","d":1,"l":1}
```

返回值中只有两个看起来像布尔值的东西，并且功能也刚好有2个被禁用了
将这个返回保存为apkplug.json，并且将1改为0:
``` json
{"err":"","d":0,"l":0}
```

在Charles中配置Map Local欺骗后，奇迹发生！
机型模拟这个功能被重新找回来了

出于对未来官方也许完全关闭旧版api的考量，现在应该先把旧版api通信过程全部保存下来以备不时之需
